<video id="player" controls autoplay width="90%"></video>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
const video = document.getElementById('player');

async function loadVideo() {
  // Step 1: fetch token from server
  const tokenResp = await fetch("https://ryvoxtb-server.onrender.com/generate-token");
  const data = await tokenResp.json();
  const token = data.token;

  const videoSrc = `https://ryvoxtb-server.onrender.com/live/tsports?token=${token}`;

  // Step 2: Load video via HLS.js
  if (Hls.isSupported()) {
    const hls = new Hls();
    hls.loadSource(videoSrc);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
  } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
    video.src = videoSrc;
    video.addEventListener('loadedmetadata', () => video.play());
  }

  // Step 3: Refresh token every 10 seconds
  setTimeout(loadVideo, 9500); // refresh 0.5s before expiry
}

// Initial load
loadVideo();
</script>
